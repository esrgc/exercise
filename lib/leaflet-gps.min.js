//Original: 4558
//Compressed: 2357
(function(){L.Control.Gps=L.Control.extend({includes:L.Mixin.Events,options:{autoActive:!1,autoTracking:!1,maxZoom:null,marker:null,textErr:null,callErr:null,style:{radius:16,weight:3,color:"#e03",fill:!1},title:"Center map on your location",position:"topleft"},initialize:function(a){a&&a.style&&(a.style=L.Util.extend({},this.options.style,a.style));L.Util.setOptions(this,a);this._errorFunc=this.options.callErr||this.showAlert;this._isActive=!1;this._currentLocation=null},onAdd:function(a){this._map=
a;a=L.DomUtil.create("div","leaflet-control-gps");this._button=L.DomUtil.create("a","gps-button",a);this._button.href="#";this._button.title=this.options.title;L.DomEvent.on(this._button,"click",L.DomEvent.stop,this).on(this._button,"click",this._switchGps,this);this._alert=L.DomUtil.create("div","gps-alert",a);this._alert.style.display="none";this._gpsMarker=this.options.marker?this.options.marker:new L.CircleMarker([0,0],this.options.style);this._map.addLayer(this._gpsMarker);this._map.on("locationfound",
this._drawGps,this).on("locationerror",this._errorGps,this);this.options.autoActive&&this.activate();return a},onRemove:function(a){this.deactivate()},_switchGps:function(){this._isActive?this.deactivate():this.activate()},getLocation:function(){return this._currentLocation},activate:function(){this._isActive=!0;this._map.locate({enableHighAccuracy:!0,watch:this.options.autoTracking,setView:!1,maxZoom:this.options.maxZoom})},deactivate:function(){this._isActive=!1;this._map.stopLocate();L.DomUtil.removeClass(this._button,
"active");this._gpsMarker.setLatLng([-90,0])},_drawGps:function(a){this._currentLocation=a.latlng;(this.options.autoTracking||this._isActive)&&this._moveTo(a.latlng);this._gpsMarker.setLatLng(a.latlng);this.fire("gpslocated",{latlng:a.latlng,marker:this._gpsMarker});L.DomUtil.addClass(this._button,"active")},_moveTo:function(a){this.options.maxZoom?this._map.setView(a,Math.min(this._map.getZoom(),this.options.maxZoom)):this._map.panTo(a)},_errorGps:function(a){this.deactivate();this._errorFunc.call(this,
this.options.textErr||a.message)},showAlert:function(a){this._alert.style.display="block";this._alert.innerHTML=a;var b=this;clearTimeout(this.timerAlert);this.timerAlert=setTimeout(function(){b._alert.style.display="none"},2E3)}});L.control.gps=function(a){return new L.Control.Gps(a)}}).call(this); 
